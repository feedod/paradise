<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat UI</title>
    <!-- Tailwind CSS v4 CDN from jsDelivr -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <!-- Telegram Web App SDK latest -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body class="bg-gray-100 h-screen flex flex-col">
    <div id="root" class="flex-1"></div>

    <script type="module">
        import React from 'https://esm.sh/react@18';
        import ReactDOM from 'https://esm.sh/react-dom@18';
        import axios from 'https://esm.sh/axios@1';

        // Configurable API settings - change these only
        const API_URL = 'https://api.openai.com/v1/chat/completions'; // Your API URL
        const API_KEY = 'your-api-key-here'; // Your API Key

        // Main App Component
        const App = () => {
            const [messages, setMessages] = React.useState([]);
            const [input, setInput] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const messagesEndRef = React.useRef(null);

            // Scroll to bottom on new messages
            React.useEffect(() => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            }, [messages]);

            // Handle input change
            const handleInputChange = (e) => {
                setInput(e.target.value);
            };

            // Handle form submit
            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim() || isLoading) return;

                const userMessage = { role: 'user', content: input };
                setMessages((prev) => [...prev, userMessage]);
                setInput('');
                setIsLoading(true);

                try {
                    const response = await axios.post(API_URL, {
                        model: 'gpt-3.5-turbo', // Adjust model as needed
                        messages: [...messages, userMessage],
                    }, {
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`,
                        },
                    });

                    const assistantContent = response.data.choices[0].message.content;
                    const assistantMessage = { role: 'assistant', content: assistantContent };
                    setMessages((prev) => [...prev, assistantMessage]);
                } catch (error) {
                    console.error(error);
                    setMessages((prev) => [...prev, { role: 'assistant', content: 'Error: ' + (error.response?.data?.error?.message || error.message) }]);
                } finally {
                    setIsLoading(false);
                }
            };

            // Integration with Telegram Web App (if running in Telegram)
            React.useEffect(() => {
                if (window.Telegram?.WebApp) {
                    window.Telegram.WebApp.ready();
                    window.Telegram.WebApp.expand();
                }
            }, []);

            return (
                <div className="flex flex-col h-screen max-w-3xl mx-auto bg-white shadow-lg">
                    {/* Header */}
                    <header className="p-4 bg-green-600 text-white text-center font-bold">
                        AI Chat
                    </header>

                    {/* Messages */}
                    <div className="flex-1 overflow-y-auto p-4 space-y-4">
                        {messages.map((msg, index) => (
                            <div
                                key={index}
                                className={`flex ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}
                            >
                                <div
                                    className={`max-w-xs md:max-w-md p-3 rounded-lg ${
                                        msg.role === 'user'
                                            ? 'bg-blue-500 text-white'
                                            : 'bg-gray-200 text-gray-800'
                                    }`}
                                >
                                    {msg.content}
                                </div>
                            </div>
                        ))}
                        {isLoading && (
                            <div className="flex justify-start">
                                <div className="max-w-xs md:max-w-md p-3 rounded-lg bg-gray-200 text-gray-800">
                                    Typing...
                                </div>
                            </div>
                        )}
                        <div ref={messagesEndRef} />
                    </div>

                    {/* Input Form */}
                    <form onSubmit={handleSubmit} className="p-4 border-t flex">
                        <input
                            type="text"
                            value={input}
                            onChange={handleInputChange}
                            placeholder="Type your message..."
                            className="flex-1 p-2 border rounded-l-lg focus:outline-none"
                            disabled={isLoading}
                        />
                        <button
                            type="submit"
                            className="bg-blue-500 text-white p-2 rounded-r-lg hover:bg-blue-600 disabled:bg-gray-400"
                            disabled={isLoading}
                        >
                            Send
                        </button>
                    </form>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>